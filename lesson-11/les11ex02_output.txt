den@ubuntu-server:~$ mysql
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 20
Server version: 8.0.21-0ubuntu0.20.04.4 (Ubuntu)

Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> use shop;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> delimiter //
mysql> CREATE PROCEDURE million_users()
    -> BEGIN
    ->   DECLARE i bigint UNSIGNED DEFAULT 1;
    ->   DECLARE max_i bigint UNSIGNED DEFAULT 1000000;
    ->   WHILE i <= max_i do
    ->     INSERT INTO users (name) VALUES (concat('User_', i));
    ->     SET i = i + 1;
    ->   END WHILE;
    -> END//
Query OK, 0 rows affected (0.03 sec)

mysql> delimiter ;
mysql> 
mysql> CALL million_users;
^C^C -- query aborted
ERROR 1317 (70100): Query execution was interrupted
mysql> 
mysql> 
mysql> delimiter //
mysql> CREATE PROCEDURE million_users_2()
    -> BEGIN
    ->   DECLARE i bigint UNSIGNED DEFAULT 0;
    ->   DECLARE max_i bigint UNSIGNED DEFAULT 1000;
    ->   DROP TABLE IF EXISTS user_buffer; 
    ->   CREATE TEMPORARY TABLE user_buffer (name varchar(255), cnt int UNSIGNED);
    ->   WHILE i < max_i do
    ->     INSERT INTO user_buffer VALUES ('User_', i);
    ->     SET i = i + 1;
    ->   END WHILE;
    ->   SET i = 0;
    ->   WHILE i < max_i do
    ->     INSERT INTO users (name) 
    ->       SELECT concat(name, i * 1000 + cnt + 1) 
    ->         FROM user_buffer;
    ->     SET i = i + 1;
    ->   END WHILE;
    -> END// 
Query OK, 0 rows affected (0.03 sec)

mysql> delimiter ;
mysql> 
mysql> CALL million_users_2;
Query OK, 1000 rows affected (1 min 24.44 sec)

mysql> 
